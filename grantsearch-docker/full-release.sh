#!/bin/bash
# Grant Search 完全リリーススクリプト
# イメージの再構築と配布パッケージの作成を行います

echo "====================================================="
echo "Grant Search 完全リリーススクリプト"
echo "====================================================="
echo "開始日時: $(date)"
echo

# 作業ディレクトリをスクリプトの場所に設定
cd "$(dirname "$0")"

# ステップ1: クリーンなDockerイメージを再構築
echo "ステップ1: クリーンなDockerイメージを再構築"
echo "-----------------------------------------------------"

# 再構築スクリプトが存在するか確認
if [ ! -f "./rebuild.sh" ]; then
  echo "エラー: rebuild.shスクリプトが見つかりません。"
  exit 1
fi

# 実行権限を付与
chmod +x ./rebuild.sh

# 再構築スクリプトを実行
./rebuild.sh

# 再構築が成功したか確認
if [ $? -ne 0 ]; then
  echo "エラー: Dockerイメージの再構築に失敗しました。"
  exit 1
fi

echo "Dockerイメージの再構築が完了しました。"
echo

# ステップ2: 配布パッケージを作成
echo "ステップ2: 配布パッケージを作成"
echo "-----------------------------------------------------"

# 配布パッケージ作成スクリプトが存在するか確認
if [ ! -f "./create-dist-package.sh" ]; then
  echo "エラー: create-dist-package.shスクリプトが見つかりません。"
  exit 1
fi

# 実行権限を付与
chmod +x ./create-dist-package.sh

# 配布パッケージ作成スクリプトを実行
./create-dist-package.sh

# 配布パッケージ作成が成功したか確認
if [ $? -ne 0 ]; then
  echo "エラー: 配布パッケージの作成に失敗しました。"
  exit 1
fi

echo "====================================================="
echo "リリースプロセスが完了しました。"
echo "終了日時: $(date)"
echo "=====================================================" 